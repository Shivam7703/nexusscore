"use client";
import { useEffect, useRef } from "react";
import Image from "next/image";
import Link from "next/link";
import { BsArrowUpRightCircleFill } from "react-icons/bs";
import { FaPlaneUp } from "react-icons/fa6";
import { serviceData } from "@/data/homeData";



export default function ServiceSection() {
  const lineRef = useRef<HTMLDivElement>(null);
  const sectionRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    let animationFrameId: number;
    let lastHeight = 0;

    const updateLineHeight = () => {
      if (!sectionRef.current || !lineRef.current) return;

      const { top, height } = sectionRef.current.getBoundingClientRect();
      const viewportHeight = window.innerHeight;
      const scrollProgress = Math.min(
        1,
        Math.max(0, (viewportHeight - top - 140) / height)
      );

      const targetHeight = scrollProgress * (height - 100);
      lastHeight += (targetHeight - lastHeight) * 0.09;

      lineRef.current.style.height = `${lastHeight}px`;

      animationFrameId = requestAnimationFrame(updateLineHeight);
    };

    animationFrameId = requestAnimationFrame(updateLineHeight);
    window.addEventListener("scroll", updateLineHeight, { passive: true });

    return () => {
      cancelAnimationFrame(animationFrameId);
      window.removeEventListener("scroll", updateLineHeight);
    };
  }, []);

  return (
    <section className="p-6 sm:p-16 lg:px-24 md:px-20 max-w-[1450px] mx-auto">
      {/* Section header */}
      <div className="w-full text-center flex flex-col items-center gap-y-4 mb-11 md:mb-16">
            <h4 className="text-blue-800 font-bold sm:text-lg mx-auto text-sm mb-2 text-center border-blue-700 w-max border-b px-3 py-2">
Our Services                </h4>
      <h2 className="text-zinc-800 font-extrabold !leading-tight text-2xl md:text-4xl text-center max-w-2xl mx-auto mb-10">
                Lorem ipsum dolor sit amet consectetur adipisicing elit.
              </h2>
      </div>

      {/* Project grid */}
      <div
        className="relative gap-y-5 md:gap-y-12 py-7 md:pb-12 flex flex-wrap max-sm:justify-end justify-between overflow-y-hidden"
        ref={sectionRef}
      >
        {/* Background static line */}
        <div className="absolute sm:left-1/2 left-2 z-10 -translate-x-1/2 bg-zinc-600 h-[94%] w-1 top-3" />

        {/* Scroll progress line */}
        <div
          ref={lineRef}
          className="absolute sm:left-1/2 left-2 z-20  -translate-x-1/2 w-1 top-3"
        >
          <div className="w-full h-full bg-gradient-to-b from-red-400 to-red-800 relative" />
          <FaPlaneUp className="text-blue-900 transition-all duration-300 absolute -bottom-3 -left-[6px] sm:-left-[12.5px] text-xl sm:text-3xl bg-white rotate-180" />
        </div>

        {/* Arrow follows the line smoothly */}

        {/* Project cards */}
       {serviceData?.services?.map((pro, index: number) => (
  <div
    key={index}
    className="lg:h-80 h-56 sm:w-[47%] w-[90%] relative group rounded-3xl overflow-hidden shadow-lg"
  >
    {/* Image */}
    <Image
      src={pro.img}
      alt={pro.title}
      fill
      className="object-cover transition-transform duration-500 group-hover:scale-105"
    />

    {/* Dark overlay */}
    <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent" />

    {/* Bottom content */}
    <Link
      href={`/projects/${pro.title
        .trim()
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "")}`}
      className="absolute bottom-0 left-0 right-0 z-20 p-6 flex items-end justify-between gap-4 text-white"
    >
      {/* Left text */}
      <div className="max-w-[75%]">
        <h2 className="text-2xl sm:text-4xl font-semibold leading-snug">
          {pro.title}
        </h2>
        <p className="mt-1 text-sm text-gray-200 line-clamp-2">
          {pro.text}
        </p>
      </div>

      {/* Right arrow */}
      <div className="flex-shrink-0 group/link">
        <BsArrowUpRightCircleFill className="text-4xl sm:text-5xl bg-white text-brown2 rounded-full p-1 transition-transform duration-300 group-hover/link:rotate-45" />
      </div>
    </Link>

    {/* Subtle border hover */}
    <div className="absolute inset-0 rounded-3xl border border-white/10 group-hover:border-white/30 transition-colors duration-300 pointer-events-none" />
  </div>
))}

      </div>
    </section>
  );
}
